/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/base/Object",'../controller/Constants','../utils/Formatter','sap/m/MessageToast',"sap/ui/model/json/JSONModel",'sap/ui/core/message/Message','sap/ui/core/MessageType','sap/ui/core/util/Export','sap/ui/core/util/ExportTypeCSV',"sap/m/MessageBox"],function(U,C,F,M,J,c,d,E,e,f){"use strict";return U.extend("ehs.em.import.datas1.utils.AmountHistoryDialog",{constructor:function(v){this._oView=v;this._oBundle=v.getController().getResourceBundle();},open:function(){var v=this._oView;var B=this._oBundle;var o=v.getController();var D=o.byId("ImportEnvDataDialog");var m=function(a,b){var w=C.messageOrder.indexOf(a.Severity);var W=C.messageOrder.indexOf(b.Severity);return w-W;};if(!D){var g={formatter:F,controller:o,onCloseDialog:function(){var a=v.byId("fileUploader");a.clear();D.close();},onImportButtonPress:function(){var a=v.byId("fileUploader");var s=jQuery.trim(a.getValue());if(s===""){f.error(B.getText("noFile"));}else if(s.toLowerCase().match("\\.xlsx$")){a.upload();D.setBusy(true);}else{f.error(B.getText("incorrectFile"));a.clear();}},handleUploadComplete:function(a){var r=a.getParameter("responseRaw");var s=a.getParameter("status");var S=+((""+s)[0]);var b=v.byId("fileUploader");var k=jQuery.trim(b.getValue());if(s===403){var l=B.getText("errorFailedAuthorization");this._showServiceError(l);}else if(S===0||S===4||S===5){this._showServiceError(r);}else if(r){var R=JSON.parse(r);var n=R.d;if(n){var p=n.ResponseMessage;if(p){var q=JSON.parse(p);q.sort(m);var t=new J({rows:q});t.setSizeLimit(200000);v.setModel(t,"messages");v.byId("msgTitle").setText(B.getText("messagesFile",[q.length,k]));this.onCloseDialog();}}}D.setBusy(false);},_showServiceError:function(s){if(this._bMessageOpen){return;}this._bMessageOpen=true;f.error(B.getText("errorText"),{id:"serviceErrorMessageBox",details:s,actions:[f.Action.CLOSE],onClose:function(){this._bMessageOpen=false;}.bind(this)});}};D=sap.ui.xmlfragment(v.getId(),"ehs.em.import.datas1.view.ImportEnvDataDialog",g);v.addDependent(D);}D.open();var h=o.getModel(C.upLoadServiceName);var i=h.getSecurityToken();var u=h.sServiceUrl+"/FileSet";var j=o.byId("fileUploader");j.setUploadUrl(u);j.destroyHeaderParameters();j.addHeaderParameter(new sap.ui.unified.FileUploaderParameter({name:"x-csrf-token",value:i}));j.addHeaderParameter(new sap.ui.unified.FileUploaderParameter({name:"Accept",value:"application/json"}));j.addHeaderParameter(new sap.ui.unified.FileUploaderParameter({name:"slug",value:C.slug}));}});});
